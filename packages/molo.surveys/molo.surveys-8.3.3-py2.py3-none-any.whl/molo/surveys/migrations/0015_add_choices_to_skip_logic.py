# -*- coding: utf-8 -*-
# Generated by Django 1.9.13 on 2017-10-11 14:13
from __future__ import unicode_literals

import json

from django.db import migrations


def create_skip_logic(apps, schema_editor):
    for field in ['MoloSurveyFormField', 'PersonalisableSurveyFormField']:
        FormField = apps.get_model('surveys', field)
        for question in FormField.objects.all():
            data = [
                {'type': 'skip_logic', 'value': {
                    'choice': choice,
                    'logic': 'next',
                    'survey': None,
                    'question': None,
                }} for choice in question.choices.split(',')]
            question.skip_logic = json.dumps(data)
            question.save()


class Migration(migrations.Migration):

    dependencies = [
        ('surveys', '0014_update_skip_logic'),
    ]

    operations = [
        migrations.RunPython(create_skip_logic)
    ]
