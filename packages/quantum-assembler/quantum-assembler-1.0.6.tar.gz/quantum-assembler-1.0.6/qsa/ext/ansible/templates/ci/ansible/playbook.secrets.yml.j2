---
- hosts: localhost
  run_once: true
  gather_facts: false
  tasks:
  {%- for env in DEPLOYMENT_ENVIRONMENTS %}
  - name: deployed secrets in {{ env.display_name or env.name }}
    retries: 5
    register: result
    no_log: true
    with_items: "{% raw %}{{ secrets }}{% endraw %}"
    tags:
    - ansible.quantumframework.org/secret:true
    - deployment.quantumframework.org/env:{{ env.name }}
    when: target_environment == '{{ env.name }}'
    k8s:
      state: present
      definition: "{% raw %}{{ item }}{% endraw %}"
  {%- endfor %}
