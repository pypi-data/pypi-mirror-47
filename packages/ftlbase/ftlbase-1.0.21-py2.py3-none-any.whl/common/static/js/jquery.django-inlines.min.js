(function(c){function h(a,b){b=c.extend({},c.fn.djangoInline.defaults,b);this.group=a;this.$group=c(a);this.options=b;b.prefix=b.prefix||this.$group.attr("id").replace(/-group$/,"");if(b.formTemplate)this.$form_template=c(b.formTemplate);else{this.$form_template=this.$group.children(".js-django-inlines-forms").children(this.options.emptyFormSelector);var d=c("input,textarea,select").filter("[required]:hidden");d.prop("required",!1);d.addClass("required")}!1!==b.showAddButton&&(this.$addButton=this.$group.find(".js-django-inlines-add-form-"+
b.prefix),this.$addButton.length?(this.$addButton.filter("a, button").click(c.proxy(this._onAddButtonClick,this)),this.$addButton.find("a, button").click(c.proxy(this._onAddButtonClick,this))):this.$addButton=this.createAddButton(),this._toggleAddButtonDisplay());var e=this;this.$group.on("click",".js-django-inlines-remove-form",function(a){a.preventDefault();e.removeForm(this)})}h.prototype={createAddButton:function(){if(this.options.childTypes){var a=c(this._renderPolymorphicAddButton());this.$group.after(a);
a.children("a").click(c.proxy(this._onMenuToggle,this));a.find("li a").click(c.proxy(this._onAddButtonClick,this))}else a=c(this._renderAddButton()),this.$group.after(a),a.find("a").click(c.proxy(this._onAddButtonClick,this));return a},_renderAddButton:function(){return'<div class="'+this.options.addCssClass+'"><a href="#">'+this.options.addText+"</a></div>"},_renderPolymorphicAddButton:function(){for(var a='<div class="add-form-choice-menu" style="display: none;"><ul>',b=0;b<this.options.childTypes.length;b++){var d=
this.options.childTypes[b];a+='<li><a href="#" data-type="'+d.type+'">'+d.name+"</a></li>"}return'<div class="'+this.options.addCssClass+' add-form-choice"><a href="#">'+this.options.addText+"</a>"+(a+"</ul></div>")+"</div>"},_onMenuToggle:function(a){a.preventDefault();a.stopPropagation();var b=c(a.target).next(".add-form-choice-menu");if(!b.is(":visible")){var d=function(){b.slideUp();c(document).unbind("click",d)};c(document).click(d)}b.slideToggle()},_onAddButtonClick:function(a){a.preventDefault();
a=c(a.target).attr("data-type");this.addForm(a?this.options.emptyFormSelector+"[data-inline-type="+a+"]":null)},_toggleAddButtonDisplay:function(){var a=this._getManagementForm();a=a.max_forms&&a.max_forms.value&&parseInt(a.total_forms.value)>=parseInt(a.max_forms.value);this.$addButton.toggle(!a)},addForm:function(a){if(a){var b=this.$form_template&&0<this.$form_template.length?this.$form_template.filter(a):this.$group.find(a);if(0===b.length)throw Error("Form template '"+a+"' not found");}else{if(!this.$form_template||
0===this.$form_template.length)throw Error("No empty form available. Define the 'form_template' setting or add an '.empty-form' element in the '"+this.options.prefix+"' formset group!");b=this.$form_template}a=this._getManagementForm();if(!a.total_forms)throw Error("Missing '#"+this._getGroupFieldIdPrefix()+"-TOTAL_FORMS' field. Make sure the management form included!");var d=null==this.options.newFormTarget?b.parent():c.isFunction(this.options.newFormTarget)?this.options.newFormTarget.apply(this.group):
this.$group.find(this.options.newFormTarget);if(null===d||0===d.length)throw Error("No container found via custom 'newFormTarget' function!");var e=parseInt(a.total_forms.value),f=this._getFormId(e);b=b.clone();b.find('[id*="__prefix__"],[name*="__prefix__"],[for*="__prefix__"],[class*="__prefix__"]').each(function(){function a(a,d){var c=a.attr(d);void 0!==c&&c.includes("__prefix__")&&(c=c.replace(/__prefix__/,e),b.attr(d,c))}var b=c(this);a(b,"id");a(b,"name");a(b,"for");"DIV"===b[0].tagName&&this.classList.contains("js-django-inlines")&&
a(b,"data-options");"A"===b[0].tagName&&this.className.match(/__prefix__/)&&a(b,"class")});b=b.removeClass("empty-form").attr("id",f);0<e&&c('div:not([id^="detail-items-"])',b).filter('div:not([id^="detail-template-"])').find(".ftl-inlines-first-only").each(function(a,b){c(b).removeClass("ftl-inlines-first-only").addClass("sr-only")});d.append(b);d=c("#"+f);if(0===d.length)throw Error("New FormSet item not found: #"+f);d.data("djangoInlineIndex",e);b.find(".required").prop("required",!0).removeClass("required");
this.options.onAdd&&this.options.onAdd.call(this.group,d,e,this.options);a.total_forms.value=e+1;return d},getFormAt:function(a){return c("#"+this._getFormId(a))},_getFormId:function(a){return this.options.itemIdTemplate.replace("{prefix}",this.options.prefix).replace("{index}",a)},_getGroupFieldIdPrefix:function(){return this.options.autoId.replace("{prefix}",this.options.prefix)},_getManagementForm:function(){var a=this._getGroupFieldIdPrefix();return{total_forms:c("#"+a+"-TOTAL_FORMS")[0],max_forms:c("#"+
a+"-MAX_NUM_FORMS")[0],group_id_prefix:a}},_getItemData:function(a){a=c(a).closest(this.options.itemsSelector);if(0===a.length)return null;var b=a.attr("id");b=(new RegExp("^"+this.options.itemIdTemplate.replace("{prefix}","(.+?)").replace("{index}","(\\d+)")+"$")).exec(b);return{formset_item:a,prefix:b[1],index:parseInt(b[2],0)}},_getItemForm:function(a){a=this._getItemData(a);if(null===a)return null;var b=this._getGroupFieldIdPrefix()+"-"+a.index;return c.extend({},a,{field_id_prefix:b,field_name_prefix:a.prefix+
"-"+a.index,pk_field:c("#"+b+"-"+this.options.pkFieldName),delete_checkbox:c("#"+b+"-DELETE")})},removeForm:function(a){var b=this._getManagementForm(),d=this._getItemForm(a);if(null===d)throw Error("No form found for the selector '"+a.selector+"'!");a=parseInt(b.total_forms.value);var e=0!==d.pk_field.length;this.options.onBeforeRemove&&this.options.onBeforeRemove.call(this.group,d.formset_item,this.options);if(e&&d.pk_field[0].value)d.delete_checkbox.length?d.delete_checkbox.attr("checked",!0):
c('<label class="" for="\' + itemform.field_id_prefix + \'-DELETE"><input type="checkbox" id="'+d.field_id_prefix+'-DELETE" name="'+d.field_name_prefix+'-DELETE" value="on" class="checkboxinput">Apagar</label>').appendTo(d),d.formset_item.hide();else{for(e=d.index+1;e<a;e++)this._renumberItem(this.getFormAt(e),e-1);b.total_forms.value--;d.formset_item.remove()}this.options.onRemove&&this.options.onRemove.call(this.group,d.formset_item,this.options);return d.formset_item},_renumberItem:function(a,
b){var d=new RegExp("("+this._getFormId("(\\d+|__prefix__)")+")"),e=this._getFormId(b);a.data("djangoInlineIndex",b);for(var f=a.add(a.find("*")),h=0;h<f.length;h++){var g=f[h],l=c(g),k=l.attr("for");k&&k.match(d)&&l.attr("for",k.replace(d,e));g.id&&g.id.match(d)&&(g.id=g.id.replace(d,e));g.name&&g.name.match(d)&&(g.name=g.name.replace(d,e))}},getFormIndex:function(a){return(a=this._getItemData(a))?a.index:null},getForms:function(){return this.$group.children(this.options.itemsSelector+":not("+this.options.emptyFormSelector+
")")},getEmptyForm:function(){return this.$form_template},getFieldIdPrefix:function(a){if(!c.isNumeric(a)){a=this._getItemData(a);if(null===a)throw Error("Unexpected element in getFieldIdPrefix, needs to be item_index, or DOM child node.");a=a.index}return this._getGroupFieldIdPrefix()+"-"+a},getFieldsAt:function(a){a=this.getFormAt(a);return this.getFields(a)},getFields:function(a){var b=this._getItemData(a);if(null===b)return null;a={};var d=b.formset_item.find(":input");b=this.prefix+"-"+b.index;
for(var c=0;c<d.length;c++){var f=d[c].name;f.substring(0,b.length)==b&&(f=f.substring(b.length+1),a[f]=d[c])}return a},removeFormAt:function(a){return this.removeForm(this.getFormAt(a))}};c.fn.djangoInline=function(a){var b=Array.prototype.splice.call(arguments,1),d="string"===typeof a?void 0:this;this.filter(".inline-group").each(function(){var e=c(this),f=e.data("djangoInline");f||e.data("djangoInline",f=new h(this,"object"===typeof a?a:{}));"string"===typeof a&&(d=f[a].apply(f,b))});return d};
c.fn.djangoInline.defaults={pkFieldName:"id",autoId:"id_{prefix}",prefix:null,newFormTarget:null,itemIdTemplate:"{prefix}-{index}",itemsSelector:".inline-related",emptyFormSelector:".empty-form",formTemplate:null,childTypes:null,showAddButton:!0,addText:"add another",addCssClass:"add-row"};c.fn.djangoInline.Constructor=h;c.fn.ready(function(){c(".js-django-inlines").each(function(){var a=c(this),b=a.data();a.djangoInline(b.options||b)})})})(window.django?window.django.jQuery:jQuery);