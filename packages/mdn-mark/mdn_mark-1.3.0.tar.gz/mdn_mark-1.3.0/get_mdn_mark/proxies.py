import random
import json
import requests_html

from zoran_tools.zoran_tools import WithProgressBar
from zoran_tools.path_tools import ask_file


# ips = [
#     "1.197.16.12:9999", "121.63.198.28:9999", "123.169.34.94:9999", "1.198.72.76:9999", "1.197.16.5:9999", "49.86.176.118:9999", "1.198.73.72:9999", "113.124.85.116:9999", "171.12.112.203:9999", "123.163.97.233:9999", "222.189.190.247:9999", "1.197.16.9:9999", "49.86.178.65:9999", "1.199.30.235:9999", "113.124.86.10:9999", "121.233.206.239:9999", "1.198.72.5:9999", "49.86.183.8:9999", "113.124.86.160:9999", "1.198.73.134:9999", "1.198.72.8:9999", "180.107.180.56:9999", "1.197.16.39:9999", "113.121.23.242:9999", "180.107.180.5:9999", "1.199.30.175:9999", "171.11.178.190:9999", "180.107.180.30:9999", "1.198.73.70:9999", "171.11.178.191:9999", "171.11.33.95:9999", "117.91.253.154:9999", "123.163.122.179:9999", "49.86.183.222:9999", "113.65.5.5:8118", "49.86.178.49:9999", "222.184.7.206:36575", "114.227.114.136:9999", "123.163.122.212:9999", "1.192.241.233:9999", "114.227.118.31:9999", "175.42.68.220:9999", "121.233.251.185:9999", "111.177.106.224:9999", "222.89.32.141:9999", "123.163.96.158:9999", "171.80.3.50:9999", "1.197.204.41:9999", "114.223.102.200:8118", "116.208.55.161:9999", "1.197.203.224:9999", "121.233.251.196:9999", "114.219.101.91:808", "49.86.181.80:9999", "1.197.203.233:9999", "222.89.32.144:9999", "1.198.73.65:9999", "121.233.206.196:9999", "117.80.24.217:9999", "121.63.198.214:9999", "182.34.27.229:9999", "117.63.82.102:9999", "61.184.109.33:50371", "117.85.21.60:9999", "113.121.20.77:9999", "180.116.50.21:9999", "117.91.248.92:9999", "117.63.81.134:9999", "121.233.206.26:9999", "1.197.16.10:9999", "218.93.63.50:9999", "180.116.48.178:9999", "180.107.180.36:9999", "117.65.46.37:9999", "113.121.21.104:9999", "106.13.117.143:3128", "1.198.72.6:9999", "222.89.32.187:9999", "1.198.73.250:9999", "123.163.97.6:9999", "113.121.22.71:9999", "117.91.253.77:9999", "180.107.180.54:9999", "171.11.178.89:9999", "222.189.190.186:9999", "113.121.22.178:9999", "1.199.30.124:9999", "123.163.97.230:9999", "123.163.122.214:9999", "1.199.30.177:9999", "219.145.232.70:8118", "1.199.30.125:9999", "1.192.243.133:9999", "180.107.180.52:9999", "117.65.45.191:9999", "1.197.203.227:9999", "117.91.255.110:9999", "1.198.72.7:9999", "49.86.181.13:9999", "180.107.180.61:9999",
#     "113.121.22.178:9999", "123.163.122.212:9999", "117.80.24.217:9999", "1.199.30.175:9999", "182.34.27.229:9999", "113.121.23.242:9999", "180.116.50.21:9999", "1.197.203.233:9999", "171.11.178.190:9999", "117.65.45.191:9999", "113.121.20.77:9999", "1.197.203.49:9999", "180.107.180.56:9999", "113.121.21.104:9999", "175.42.68.220:9999", "121.233.251.196:9999", "171.12.112.203:9999", "121.233.206.196:9999", "1.198.73.70:9999", "222.89.32.141:9999", "218.75.69.50:39700", "1.198.73.65:9999", "1.197.16.12:9999", "210.61.46.165:3128", "121.233.206.26:9999", "1.197.16.10:9999", "123.163.97.233:9999", "113.124.85.116:9999", "114.219.101.91:808", "180.107.180.54:9999", "117.85.21.60:9999", "222.89.32.144:9999", "1.197.16.9:9999", "117.91.253.154:9999", "114.227.118.31:9999", "117.65.46.37:9999", "116.208.55.161:9999", "49.86.176.118:9999", "1.197.16.39:9999", "123.163.96.158:9999", "1.192.241.233:9999", "123.169.34.94:9999", "218.93.63.50:9999", "1.198.72.6:9999", "121.233.251.185:9999", "61.184.109.33:50371", "171.11.178.191:9999", "117.63.82.102:9999", "113.124.86.10:9999", "113.121.22.71:9999", "180.107.180.30:9999", "1.199.30.124:9999", "180.116.48.178:9999", "1.197.16.5:9999", "121.233.206.239:9999", "123.163.122.179:9999", "113.124.86.160:9999", "171.80.3.50:9999", "123.245.12.54:8118", "117.91.253.77:9999", "180.107.180.52:9999", "1.197.203.227:9999", "1.197.204.41:9999", "222.189.190.247:9999", "171.11.178.89:9999", "49.86.181.80:9999", "119.138.225.50:8118", "121.63.198.28:9999", "27.188.42.62:8118", "219.145.232.70:8118", "171.11.33.95:9999", "14.115.206.197:9999", "1.199.30.125:9999", "1.198.72.8:9999", "121.63.198.214:9999", "222.89.32.187:9999", "49.86.178.65:9999", "49.86.183.8:9999", "49.86.181.13:9999", "117.63.81.134:9999", "1.197.203.224:9999", "111.177.106.224:9999", "1.192.243.133:9999", "115.207.86.69:8118", "117.91.255.110:9999", "123.163.97.6:9999", "1.198.73.72:9999", "123.163.97.230:9999", "1.199.30.177:9999", "1.198.73.250:9999", "222.189.190.186:9999", "180.107.180.5:9999", "1.199.30.235:9999", "180.107.180.36:9999", "117.91.248.92:9999", "180.107.180.61:9999", "49.86.178.49:9999", "1.198.73.134:9999", "1.198.72.7:9999", "1.198.72.5:9999",
#     '110.52.235.82:9999', '110.52.235.226:9999', '110.52.235.7:9999', '112.85.130.231:9999', '175.11.195.78:8118', '49.84.151.169:53281', '122.193.244.105:9999', '112.87.68.213:9999', '110.52.235.9:9999', '121.236.196.48:8118',
#     '180.160.69.104:8118', '110.52.235.164:9999', '27.219.97.241:8118', '182.121.69.3:8118', '110.52.235.18:9999', '110.52.235.53:9999', '110.52.235.37:9999', '115.193.164.144:8118', '218.60.8.99:3129', '49.76.55.54:9999', '110.52.235.33:9999',
#     '113.121.23.240:9999', '110.52.235.19:9999', '110.52.235.108:9999', '112.87.70.177:9999', '112.85.129.153:9999', '110.52.235.65:9999', '180.113.35.250:8118', '180.160.76.53:8118', '113.121.23.84:9999', '110.52.235.251:9999',
#     '110.52.235.176:9999', '110.52.235.124:9999', '1.198.73.182:9999', '110.52.235.192:9999', '112.85.130.27:9999', '115.53.16.149:9999', '121.235.229.1:9999', '112.87.68.21:9999', '27.219.115.145:8118', '112.85.166.96:9999', '110.52.235.38:9999',
#     '110.52.235.96:9999', '110.52.235.243:9999', '112.85.130.28:9999', '112.87.68.108:9999', '1.197.204.51:9999', '110.52.235.20:9999', '112.87.71.229:9999', '113.200.56.13:8010', '121.233.206.48:9999', '182.34.34.197:9999',
#     '110.52.235.151:9999', '110.52.235.219:9999', '110.52.235.29:9999', '112.87.69.74:9999', '119.162.42.140:8118', '122.193.245.201:9999', '112.80.41.80:8888', '112.85.130.24:9999', '112.85.130.154:9999', '110.52.235.112:9999', '27.191.234.69:9999',
#     '112.85.129.126:9999', '110.52.235.233:9999', '122.193.245.38:9999', '221.193.168.142:8118', '123.55.39.159:53281', '110.52.235.209:9999', '110.52.235.31:9999', '110.52.235.55:9999', '119.176.85.226:9999', '110.52.235.111:9999',
#     '110.52.235.17:9999', '123.52.19.46:3128', '110.52.235.73:9999', '111.197.236.117:9999', '110.52.235.2:9999', '114.217.233.29:9999', '110.52.235.90:9999', '110.52.235.161:9999', '114.249.115.206:9000', '112.85.166.135:9999',
#     '115.53.16.222:9999', '110.52.235.184:9999', '112.80.41.85:8888', '218.60.8.83:3129', '110.52.235.74:9999', '112.85.130.152:9999', '115.148.138.116:8118', '111.164.173.163:8118', '110.52.235.49:9999', '112.80.41.79:8888', '27.10.223.80:8118',
#     '118.78.196.145:8118', '219.145.232.70:8118', '112.85.130.45:9999', '1.197.203.104:9999', '123.245.12.54:8118', '112.85.129.25:9999'
# ]


alive_ips = ["1.198.73.70:9999", "114.227.114.136:9999", "61.184.109.33:50371", "180.107.180.30:9999", "121.63.198.214:9999", "110.52.235.7:9999", "112.85.130.231:9999", "110.52.235.9:9999", "110.52.235.53:9999", "218.60.8.99:3129", "49.76.55.54:9999", "112.87.70.177:9999", "110.52.235.192:9999", "112.87.68.21:9999", "112.87.71.229:9999", "113.200.56.13:8010", "110.52.235.219:9999", "112.85.130.154:9999", "122.193.245.38:9999", "123.55.39.159:53281", "110.52.235.111:9999", "110.52.235.17:9999", "123.52.19.46:3128", "111.197.236.117:9999", "110.52.235.184:9999", "218.60.8.83:3129", "110.52.235.74:9999", "1.197.203.104:9999"]


def random_proxy(ips=alive_ips) -> dict:
    ip = random.choice(ips)
    return {'https': 'https://' + ip, 'http': 'http://' + ip}


def choose_alive_proxy(ips):
    alive = []
    to_file = 'alive_ips.txt'
    for ip in WithProgressBar(ips):
        proxy = {'https': 'https://' + ip, 'http': 'http://' + ip}
        url = 'https://www.sogou.com/reventondc/inner/vrapi?number={mdn}&type=json&callback=show&isSogoDomain=1'. \
            format(mdn='057486855016')
        try:
            r = requests_html.HTMLSession().get(url, proxies=proxy, timeout=3)
            if r.status_code == 200:
                alive.append(ip)
        except:
            pass
    with open(to_file, mode='w') as f:
        f.write('\n'.join(alive))
    print('可用IP写入了{}'.format(to_file))


def proxies(file=None):
    if not file:
        return alive_ips
    with open(file, mode='r') as f:
        lines = f.readlines()
        return [line.strip('\n') for line in lines]


def open_proxy_file():
    ip_file = ask_file()
    with open(ip_file, mode='r') as f:
        lines = f.readlines()
        return [line.strip('\n') for line in lines]


def screen_alive_proxies():
    choose_alive_proxy(open_proxy_file())


if __name__ == '__main__':
    choose_alive_proxy()
