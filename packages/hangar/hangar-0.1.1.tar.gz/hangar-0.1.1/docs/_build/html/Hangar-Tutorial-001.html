

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating A Repository And Working With Data &mdash; Hangar 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Part 2: Checkouts, Branching, &amp; Merging" href="Hangar-Tutorial-002.html" />
    <link rel="prev" title="Hangar Tutorial" href="tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Hangar
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Hangar Core Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Hangar Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating A Repository And Working With Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-interacting-with-a-hangar-repository">Creating &amp; Interacting with a Hangar Repository</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initializing-a-repository">Initializing a repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#checking-out-the-repo-for-writing">Checking out the repo for writing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lots-of-useful-information-is-in-the-ipython-repr">Lots of useful information is in the ipython <code class="docutils literal notranslate"><span class="pre">__repr__</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-checkout-allows-access-to-datasets-and-metadata">A checkout allows access to <code class="docutils literal notranslate"><span class="pre">datasets</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#before-data-can-be-added-to-a-repository-a-dataset-must-be-initialized">Before data can be added to a repository, a dataset must be initialized.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interaction">Interaction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-data">Adding Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-many-samples-are-in-the-dataset">How many samples are in the dataset?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#containment-testing">containment testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dictionary-style-retrieval-for-known-keys">Dictionary Style Retrieval for known keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dict-style-iteration-supported-out-of-the-box">Dict style iteration supported out of the box</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#committing-changes">Committing Changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dont-forget-to-close-the-write-enabled-checkout">Don’t Forget to Close the Write-Enabled Checkout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#but-if-you-did-forget">But, if you did forget…</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inspecting-state">Inspecting State</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Hangar-Tutorial-002.html">Part 2: Checkouts, Branching, &amp; Merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hangar-Tutorial-002.html#merging-part-2-three-way-merge">Merging (Part 2) Three Way Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hangar-Tutorial-002.html#conflicts">Conflicts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Hangar Under The Hood</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="codeofconduct.html">Contributor Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hangar</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorial.html">Hangar Tutorial</a> &raquo;</li>
        
      <li>Creating A Repository And Working With Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Hangar-Tutorial-001.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="creating-a-repository-and-working-with-data">
<h1>Creating A Repository And Working With Data<a class="headerlink" href="#creating-a-repository-and-working-with-data" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will review the first steps of working with a hangar
repository.</p>
<p>To fit with the beginner’s theme, we will use the MNIST dataset. Later
examples will show off how to work with much more complex data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hangar</span> <span class="kn">import</span> <span class="n">Repository</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gzip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
<div class="section" id="creating-interacting-with-a-hangar-repository">
<h2>Creating &amp; Interacting with a Hangar Repository<a class="headerlink" href="#creating-interacting-with-a-hangar-repository" title="Permalink to this headline">¶</a></h2>
<p>Hangar is designed to “just make sense” in every operation you have to perform.
As such, there is a single interface which all interaction begins with: the
<code class="docutils literal notranslate"><span class="pre">Repository</span></code> object.</p>
<p>Weather a hangar repository exists at the path you specify or not, just tell
hangar where it should live!</p>
<div class="section" id="initializing-a-repository">
<h3>Initializing a repository<a class="headerlink" href="#initializing-a-repository" title="Permalink to this headline">¶</a></h3>
<p>The first time you want to work with a new repository, the <code class="docutils literal notranslate"><span class="pre">init()</span></code> method
must be called. This is where you provide hangar with your name and email
address (to be used in the commit log), as well as implicitly confirming that
you do want to create the underlying data files hangar uses on disk.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/Users/rick/projects/tensorwerk/hangar-dev-repo/&#39;</span><span class="p">)</span>

<span class="go"># First time a repository is accessed only!</span>
<span class="go"># Note: if you feed a path to the `Repository` which does not contain a pre-initialized hangar repo,</span>
<span class="go"># when the Repository object is initialized it will let you know that you need to run `init()`</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">user_name</span><span class="o">=</span><span class="s1">&#39;Rick Izzo&#39;</span><span class="p">,</span> <span class="n">user_email</span><span class="o">=</span><span class="s1">&#39;foo@email.com&#39;</span><span class="p">)</span>
<span class="go">directory initialized at: /Users/rick/projects/tensorwerk/hangar-dev-repo/__hangar</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-out-the-repo-for-writing">
<h2>Checking out the repo for writing<a class="headerlink" href="#checking-out-the-repo-for-writing" title="Permalink to this headline">¶</a></h2>
<p>A repository can be checked out in two modes:</p>
<ol class="arabic simple">
<li><p>write-enabled: applies all operations to the staging area’s current
state. Only one write-enabled checkout can be active at a different time,
must be closed upon last use, or manual intervention will be needed to remove
the writer lock.</p></li>
<li><p>read-only: checkout a commit or branch to view repository state as it
existed at that point in time.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="lots-of-useful-information-is-in-the-ipython-repr">
<h3>Lots of useful information is in the ipython <code class="docutils literal notranslate"><span class="pre">__repr__</span></code><a class="headerlink" href="#lots-of-useful-information-is-in-the-ipython-repr" title="Permalink to this headline">¶</a></h3>
<p>If you’re ever in doubt about what the state of the object your working
on is, just call it’s reps, and the most relevant information will be
sent to your screen!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span>
<span class="go">Hangar WriterCheckout</span>
<span class="go">    Writer       : True</span>
<span class="go">    Base Branch  : master</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-checkout-allows-access-to-datasets-and-metadata">
<h2>A checkout allows access to <code class="docutils literal notranslate"><span class="pre">datasets</span></code> and <code class="docutils literal notranslate"><span class="pre">metadata</span></code><a class="headerlink" href="#a-checkout-allows-access-to-datasets-and-metadata" title="Permalink to this headline">¶</a></h2>
<p>The <cite>dataset</cite> and <cite>metadata</cite> attributes of a checkout provide
the interface to working with all of the data on disk!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span><span class="o">.</span><span class="n">datasets</span>
<span class="go">Hangar Datasets</span>
<span class="go">    Writeable: True</span>
<span class="go">    Dataset Names:</span>
<span class="go">        -                # No datasets added yet!</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">co</span><span class="o">.</span><span class="n">metadata</span>
<span class="go">Hangar Metadata</span>
<span class="go">    Number of Keys : 0</span>
<span class="go">    Access Mode    : a</span>
</pre></div>
</div>
<div class="section" id="before-data-can-be-added-to-a-repository-a-dataset-must-be-initialized">
<h3>Before data can be added to a repository, a dataset must be initialized.<a class="headerlink" href="#before-data-can-be-added-to-a-repository-a-dataset-must-be-initialized" title="Permalink to this headline">¶</a></h3>
<p>We’re going to first load up a the MNIST pickled dataset so it can be added to
the repo!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataset</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/Users/rick/projects/tensorwerk/hangar-dev-data/mnist.pkl.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">train_set</span><span class="p">,</span> <span class="n">valid_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;bytes&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">rescale</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">array</span> <span class="o">=</span> <span class="n">array</span> <span class="o">*</span> <span class="mi">256</span>
<span class="o">...</span>     <span class="n">rounded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">rounded</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">())</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_trimg</span> <span class="o">=</span> <span class="n">rescale</span><span class="p">(</span><span class="n">train_set</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sample_trlabel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">train_set</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">trimgs</span> <span class="o">=</span> <span class="n">rescale</span><span class="p">(</span><span class="n">train_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">trlabels</span> <span class="o">=</span> <span class="n">train_set</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>A Dataset is a named grouping of data samples where each sample shares a number
of similar attributes and array properties. See the docstrings in
<cite>co.datasets.init_dataset</cite>:</p>
<p>Let’s try it out here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">init_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mnist_training_images&#39;</span><span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">trimgs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">Dataset prototype shape: (784,), dtype: uint8</span>
<span class="go">Hangar DatasetDataWriter</span>
<span class="go">    Dataset Name     : mnist_training_images</span>
<span class="go">    Schema UUID      : d72247d253df11e992758c859047adef</span>
<span class="go">    Schema Hash      : RM4DefFsjRs=</span>
<span class="go">    Variable Shape   : False</span>
<span class="go">    (max) Shape      : (784,)</span>
<span class="go">    Datatype         : &lt;class &#39;numpy.uint8&#39;&gt;</span>
<span class="go">    Named Samples    : True</span>
<span class="go">    Access Mode      : a</span>
<span class="go">    Num Samples      : 0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="interaction">
<h2>Interaction<a class="headerlink" href="#interaction" title="Permalink to this headline">¶</a></h2>
<p>When a dataset is initialized, a dataset accessor object will be returned,
however, depending on your use case, this may or may not be the most convenient
way to access a dataset.</p>
<p>In general, we have implemented a full <code class="docutils literal notranslate"><span class="pre">dict</span></code> mapping interface on top of all
object. To access the <code class="docutils literal notranslate"><span class="pre">'mnist_training_images'</span></code> dataset you can just use a
dict style access like the following (note: if operating in ipython/jupyter, the
dataset keys will autocomplete for you).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;mnist_training_images&#39;</span><span class="p">]</span>
<span class="go">Hangar DatasetDataWriter</span>
<span class="go">    Dataset Name     : mnist_training_images</span>
<span class="go">    Schema UUID      : d72247d253df11e992758c859047adef</span>
<span class="go">    Schema Hash      : RM4DefFsjRs=</span>
<span class="go">    Variable Shape   : False</span>
<span class="go">    (max) Shape      : (784,)</span>
<span class="go">    Datatype         : &lt;class &#39;numpy.uint8&#39;&gt;</span>
<span class="go">    Named Samples    : True</span>
<span class="go">    Access Mode      : a</span>
<span class="go">    Num Samples      : 0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">train_dset</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;mnist_training_images&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>the full dictionary style mapping interface is implemented</p>
<div class="section" id="adding-data">
<h3>Adding Data<a class="headerlink" href="#adding-data" title="Permalink to this headline">¶</a></h3>
<p>To add data to a named dataset, we can use dict-style setting, or the
<code class="docutils literal notranslate"><span class="pre">.add</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">train_dset</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trimgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_dset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">trimgs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_dset</span><span class="p">[</span><span class="s1">&#39;51&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trimgs</span><span class="p">[</span><span class="mi">51</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="how-many-samples-are-in-the-dataset">
<h3>How many samples are in the dataset?<a class="headerlink" href="#how-many-samples-are-in-the-dataset" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">train_dset</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
</div>
<div class="section" id="containment-testing">
<h3>containment testing<a class="headerlink" href="#containment-testing" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;hi&#39;</span> <span class="ow">in</span> <span class="n">train_dset</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;0&#39;</span> <span class="ow">in</span> <span class="n">train_dset</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionary-style-retrieval-for-known-keys">
<h3>Dictionary Style Retrieval for known keys<a class="headerlink" href="#dictionary-style-retrieval-for-known-keys" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">train_dset</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>
</pre></div>
</div>
<img alt="_images/output_26_1.png" src="_images/output_26_1.png" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">train_dset</span>
<span class="go">Hangar DatasetDataWriter</span>
<span class="go">    Dataset Name     : mnist_training_images</span>
<span class="go">    Schema UUID      : d72247d253df11e992758c859047adef</span>
<span class="go">    Schema Hash      : RM4DefFsjRs=</span>
<span class="go">    Variable Shape   : False</span>
<span class="go">    (max) Shape      : (784,)</span>
<span class="go">    Datatype         : &lt;class &#39;numpy.uint8&#39;&gt;</span>
<span class="go">    Named Samples    : True</span>
<span class="go">    Access Mode      : a</span>
<span class="go">    Num Samples      : 2</span>
</pre></div>
</div>
</div>
<div class="section" id="dict-style-iteration-supported-out-of-the-box">
<h3>Dict style iteration supported out of the box<a class="headerlink" href="#dict-style-iteration-supported-out-of-the-box" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">train_dset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="c1"># equivalent method: `for k in train_dset.keys():`</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="go"> out = []</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">train_dset</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">myDict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">train_dset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">myDict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h2>
<p>Once you’ve completed an interactive exploration, be sure to use the context
manager form of the <code class="docutils literal notranslate"><span class="pre">.add</span></code> and <code class="docutils literal notranslate"><span class="pre">.get</span></code> methods!</p>
<p>In order to make sure that all your data is always safe in Hangar, the backend
diligently ensures that all contexts (operations which can somehow interact
with the record structures) are opened and closed appropriately. When you use the
context manager form of a dataset object, we can offload a significant amount of
work to the python runtime, and dramatically increase read and write speeds.</p>
<p>Most datasets we’ve tested see an increased throughput differential of 250% -
500% for writes and 300% - 600% for reads when comparing using the context
manager form vs the naked form!</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go"># ------------------ Context Manager Form ----------------------</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dset_trimgs</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">init_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;train_images&#39;</span><span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">sample_trimg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dset_trlabels</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">init_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;train_labels&#39;</span><span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">sample_trlabel</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">trimgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># one record for each dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">dset_trimgs</span><span class="p">,</span> <span class="n">dset_trlabels</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trimgs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">500</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">dset_trimgs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">dset_trlabels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">trlabels</span><span class="p">[</span><span class="n">idx</span><span class="p">]]),</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="go">100%|██████████| 100000/100000 [00:24&lt;00:00, 3962.72it/s]</span>

<span class="go"># Completed in 24 seconds to add 100,000 records of MNIST to the repository.</span>

<span class="go"># ----------------- Non-Context Manager Form ----------------------</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">trimgs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trimgs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">500</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">dset_trimgs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">dset_trlabels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">trlabels</span><span class="p">[</span><span class="n">idx</span><span class="p">]]),</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pbar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="go">100%|██████████| 100000/100000 [02:57&lt;00:00, 574.59it/s]</span>

<span class="go"># Completed in ~3 minutes to add the same 100,000 records to the repository</span>
</pre></div>
</div>
<p>Clearly, the context manager form is far and away superior, however we fell that
for the purposes of interactive use that the “Naked” form is valubal to the
average user!</p>
</div>
<div class="section" id="committing-changes">
<h2>Committing Changes<a class="headerlink" href="#committing-changes" title="Permalink to this headline">¶</a></h2>
<p>Once you have made a set of changes you wan’t to commit, just simply
call the <code class="docutils literal notranslate"><span class="pre">commit()</span></code> method (and pass in a message)!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">co</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="s1">&#39;hello world, this is my first hangar commit&#39;</span><span class="p">)</span>
<span class="go">&#39;ce7dfe7c548aec58&#39;</span>
</pre></div>
</div>
<p>The returned value (<cite>‘ce7dfe7c548aec58’</cite>) is the commit hash of this commit. It
may be useful to assign this to a variable and follow this up by creating a
branch from this commit! (Branching to be covered in the next round of
tutorials)</p>
<div class="section" id="dont-forget-to-close-the-write-enabled-checkout">
<h3>Don’t Forget to Close the Write-Enabled Checkout<a class="headerlink" href="#dont-forget-to-close-the-write-enabled-checkout" title="Permalink to this headline">¶</a></h3>
<p>We mentioned in <a class="reference internal" href="#checking-out-the-repo-for-writing">Checking out the repo for writing</a> that when a <cite>write-enabled</cite>
checkout is created, it places a lock on writers until it is closed. If for
whatever reason the program terminates without closing the write-enabled
checkout, this lock will persist (forever technically, but realistically until
it is manually freed).</p>
<p>Luckily, preventing this issue from occurring is as simple as calling <cite>close()</cite>!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Just call...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">co</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="but-if-you-did-forget">
<h3>But, if you did forget…<a class="headerlink" href="#but-if-you-did-forget" title="Permalink to this headline">¶</a></h3>
<p>you will receive a <code class="docutils literal notranslate"><span class="pre">PermissionError</span></code> next time you open a checkout!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">PermissionError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">acquire</span> <span class="n">the</span> <span class="n">writer</span> <span class="n">lock</span><span class="o">.</span> <span class="n">Only</span> <span class="n">one</span> <span class="n">instance</span> <span class="n">of</span>
<span class="n">a</span> <span class="n">writer</span> <span class="n">checkout</span> <span class="n">can</span> <span class="n">be</span> <span class="n">active</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span><span class="o">.</span> <span class="n">If</span> <span class="n">the</span> <span class="n">last</span> <span class="n">checkout</span> <span class="n">of</span> <span class="n">this</span>
<span class="n">repository</span> <span class="n">did</span> <span class="ow">not</span> <span class="n">properly</span> <span class="n">close</span><span class="p">,</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">crash</span> <span class="n">occurred</span><span class="p">,</span> <span class="n">the</span> <span class="n">lock</span> <span class="n">must</span> <span class="n">be</span>
<span class="n">manually</span> <span class="n">freed</span> <span class="n">before</span> <span class="n">another</span> <span class="n">writer</span> <span class="n">can</span> <span class="n">be</span> <span class="n">instantiated</span><span class="o">.</span>
</pre></div>
</div>
<p>It’s an easy fix! JUST BE CAREFUL!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span><span class="o">.</span><span class="n">force_release_writer_lock</span><span class="p">()</span>
<span class="go">/Users/rick/projects/tensorwerk/hangar-py/src/hangar/records/heads.py:141:</span>
<span class="go"> UserWarning: USER WARNING: Writer lock force released. warnings.warn(</span>
<span class="go"> &#39;USER WARNING: Writer lock force released.&#39;)</span>

<span class="go">True</span>
</pre></div>
</div>
<p>This is a dangerous operation, and is one of the only ways where a user can put
data in their repository at risk! If another python process is still holding the
lock, do NOT force the release. Kill the process (that’s totally fine to do at
any time, then force the lock release).</p>
<p>When in doubt, refer to the docstrings:</p>
</div>
</div>
<div class="section" id="inspecting-state">
<h2>Inspecting State<a class="headerlink" href="#inspecting-state" title="Permalink to this headline">¶</a></h2>
<p>After your first commit, the summary and log methods will begin to work,
and you can either print the stream to the console (as shown below), or
you can dig deep into the internal of how hangar thinks about your data!
(To be covered in an advanced tutorial later on).</p>
<p>The point is, regardless of your level of interaction with a live hangar
repository, all level of state is accessible from the top, and in
general has been built to be the only way to directly access it!</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="go">Summary of Contents Contained in Data Repository</span>

<span class="go">==================</span>
<span class="go">| Repository Info</span>
<span class="go">|-----------------</span>
<span class="go">|  Directory: /Users/rick/projects/tensorwerk/hangar-dev-repo/__hangar</span>
<span class="go">|  Disk Usage: 46.13 MB</span>

<span class="go">===================</span>
<span class="go">| Commit Details</span>
<span class="go">-------------------</span>
<span class="go">|  Commit: ce7dfe7c548aec58</span>
<span class="go">|  Created: Sun Mar 31 18:29:48 2019</span>
<span class="go">|  By: Rick Izzo</span>
<span class="go">|  Email: foo@email.com</span>
<span class="go">|  Message: &#39;hello world, this is my first hangar commit&#39;</span>

<span class="go">==================</span>
<span class="go">| DataSets</span>
<span class="go">|-----------------</span>
<span class="go">|  Number of Named Datasets: 2</span>
<span class="go">|</span>
<span class="go">|  * Dataset Name: train_images</span>
<span class="go">|    Num Arrays: 50000</span>
<span class="go">|    Details:</span>
<span class="go">|    - schema_uuid: daab93a653e211e989a98c859047adef</span>
<span class="go">|    - schema_hash: RM4DefFsjRs=</span>
<span class="go">|    - schema_dtype: 2</span>
<span class="go">|    - schema_is_var: False</span>
<span class="go">|    - schema_max_shape: [784]</span>
<span class="go">|    - schema_is_named: True</span>
<span class="go">|</span>
<span class="go">|  * Dataset Name: train_labels</span>
<span class="go">|    Num Arrays: 50000</span>
<span class="go">|    Details:</span>
<span class="go">|    - schema_uuid: daf2623653e211e9acd18c859047adef</span>
<span class="go">|    - schema_hash: ncbHqE6Xldg=</span>
<span class="go">|    - schema_dtype: 7</span>
<span class="go">|    - schema_is_var: False</span>
<span class="go">|    - schema_max_shape: [1]</span>
<span class="go">|    - schema_is_named: True</span>

<span class="go">==================</span>
<span class="go">| Metadata:</span>
<span class="go">|-----------------</span>
<span class="go">|  Number of Keys: 0</span>
</pre></div>
</div>
<p>And then to view the log in graph format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
<span class="go">* ce7dfe7c548aec58 (31Mar2019 18:29:48) (Rick Izzo): hello world, first commit</span>
</pre></div>
</div>
<p>(don’t worry, this will fill up in later tutorials!)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Hangar-Tutorial-002.html" class="btn btn-neutral float-right" title="Part 2: Checkouts, Branching, &amp; Merging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.html" class="btn btn-neutral float-left" title="Hangar Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020, Richard Izzo
      <span class="lastupdated">
        Last updated on May 24, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>