

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hangar Under The Hood &mdash; Hangar 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API" href="api.html" />
    <link rel="prev" title="Part 2: Checkouts, Branching, &amp; Merging" href="Hangar-Tutorial-002.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Hangar
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Hangar Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Hangar Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hangar Under The Hood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#things-in-life-change-your-data-shouldn-t">Things In Life Change, Your Data Shouldn’t</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-is-large-we-don-t-waste-space">Data Is Large, We Don’t Waste Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-basics-of-collaboration-branching-and-merging">The Basics of Collaboration: Branching and Merging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#numbers-numbers">Numbers == Numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#records-numbers">Records != Numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#history-is-relative">History is Relative</a></li>
<li class="toctree-l3"><a class="reference internal" href="#merge-strategies">Merge Strategies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="codeofconduct.html">Contributor Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hangar</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Hangar Under The Hood</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/design.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="hangar-under-the-hood">
<span id="ref-hangar-under-the-hood"></span><h1>Hangar Under The Hood<a class="headerlink" href="#hangar-under-the-hood" title="Permalink to this headline">¶</a></h1>
<p>At it’s core, hangar is a content addressable data store whose design
requirements were inspired by the Git version control system.</p>
<div class="section" id="things-in-life-change-your-data-shouldn-t">
<h2>Things In Life Change, Your Data Shouldn’t<a class="headerlink" href="#things-in-life-change-your-data-shouldn-t" title="Permalink to this headline">¶</a></h2>
<p>When designing a high performance data version control system, achieving
performance goals while ensuring consistency is incredibly difficult. Memory is
fast, disk is slow; not much we can do about it. But since Hangar should
deal with any numeric data in an array of any size (with an enforced limit of
31 dimensions in a sample…) we have to find ways to work <em>with</em> the disk,
not against it.</p>
<p>Upon coming to terms with this face, we are actually presented with a problem
once we realize that we live in the real world, and real world is ugly.
Computers crash, processes get killed, and people do * <em>interesting</em> * things.
Because of this, It is a foundational design principle for us to <strong>guarantee
that once Hangar says data has been successfully added to the repository, it is
actually persisted.</strong> This essentially means that any process which interacts
with data records on disk must be stateless. If (for example) we were to keep a
record of all data added to the staging area in an in-memory list, and the
process gets killed, we may have just lost references to all of the array data,
and may not even be sure that the arrays were flushed to disk properly. These
situations are a NO-GO from the start, and will always remain so.</p>
<p>So, we come to the first design choice: <strong>read and write actions are atomic</strong>.
Once data is added to a hangar repository, the numeric array along with the
necessary book-keeping records will <em>always</em> occur transactionally, ensuring
that when something unexpected happens, the data and records are committed to
disk.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The atomicity of interactions is completely hidden from a normal user; they
shouldn’t have to care about this or even know this exists. However, this
is also why using the context-manager style dataset interaction scheme can
result in ~2x times speedup on writes/reads. We can just pass on most of the
work to the python <code class="docutils literal notranslate"><span class="pre">contextlib</span></code> package instead of having to begin and
commit/abort (depending on interaction mode) transactions with every call to
an <cite>add</cite> or <cite>get</cite> method.</p>
</div>
</div>
<div class="section" id="data-is-large-we-don-t-waste-space">
<h2>Data Is Large, We Don’t Waste Space<a class="headerlink" href="#data-is-large-we-don-t-waste-space" title="Permalink to this headline">¶</a></h2>
<p>From the very beginning we knew that while it would be easy to just store all
data in every commit as independent arrays on disk, such a naive implementation
would just absolutely eat up disk space for any repository with a non-trivial
history. Hangar commits should be fast and use minimal disk space, duplicating
data just doesn’t make sense for such a system. And so we decided on implementing
a content addressable data store backend.</p>
<p>When a user requests to add data to a hangar repository, one of the first
operations which occur is to generate a hash of the array contents. If the hash
does not match a piece of data already placed in the hangar repository, the data
is sent to the appropriate storage backend methods. On success, the backend
sends back some arbitrary specification which can be used to retrieve that same
piece of data from that particular backend. The record backend then stores a
key/value pair of (<cite>hash</cite>, <cite>backend_specification</cite>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The record backend stores hash information in a separate location from the
commit references (which associate a <cite>(datasetname, sample name/id)</cite> to a
<cite>(sample uuid, sample_hash)</cite>). This let’s us separate the historical repository
information from a particular computer’s location of a data piece. All we need in
the public history is to know that some data with a particular hash is
associated with a commit. No one but the system which actually needs to access
the data needs to know where it can be found.</p>
</div>
<p>On the other hand, if a data sample is added to a repository which already has a
record of some hash, we don’t even involve the storage backend. All we need to
do is just record that a new sample in a dataset was added with that hash. It
makes no sense to write the same data twice.</p>
<p>This method can actually result in massive space savings for some common use
cases. For the MNIST dataset, the training label data is typically a 1D-array of
size 50,000. Because there are only 10 labels, we only need to store 10 ints on
disk, and just keep references to the rest.</p>
</div>
<div class="section" id="the-basics-of-collaboration-branching-and-merging">
<h2>The Basics of Collaboration: Branching and Merging<a class="headerlink" href="#the-basics-of-collaboration-branching-and-merging" title="Permalink to this headline">¶</a></h2>
<p>Up to this point, we haven’t actually discussed much about how data and records
are treated on disk. We’ll leave an entire walkthrough of the backend record
structure for another tutorial, but let’s introduce the basics here, and see how
we enable the types of branching and merging operations you might be used to
with source code (at largely the same speed!).</p>
<p>Here’s a few core principles to keep in mind:</p>
<div class="section" id="numbers-numbers">
<h3>Numbers == Numbers<a class="headerlink" href="#numbers-numbers" title="Permalink to this headline">¶</a></h3>
<p>Hangar has no concept of what a piece of data is outside of a string of bytes /
numerical array, and most importantly, <em>hangar does not care</em>; Hangar is a tool,
and we leave it up to you to know what your data actually
means)!</p>
<p>At the end of the day when the data is placed into <em>some</em> collection on disk,
the storage backend we use won’t care either. In fact, this is the entire reason
why Hangar can do what it can; we don’t attempt to treat data as anything other
then a series of bytes on disk!</p>
<p>The fact that <em>Hangar does not care about what your data represents</em> is a
fundamental underpinning of how the system works under the hood. It is the
<em>designed and intended behavior</em> of Hangar to dump arrays to disk in what would
seem like completely arbitrary buffers/locations to an outside observer. And for
the most part, they would be essentially correct in their observation that data
samples on disk are in strange locations.</p>
<p>While there is almost no organization or hierarchy for the actual data samples
when they are stored on disk, that is not to say that they are stored without
care! We may not care about global trends, but we do care a great deal about the
byte order/layout, sequentiality, chunking/compression and validations
operations which are applied across the bytes which make up a data sample.</p>
<p>In other words, we optimize for utility and performance on the backend, not so
that a human can understand the file format without a computer! After the array
has been saved to disk, all we care about is that bookkeeper can record some
unique information about where some piece of content is, and how we can read it.
<strong>None of that information is stored alongside the data itself - Remember:
numbers are just numbers - they don’t have any concept of what they are</strong>.</p>
</div>
<div class="section" id="records-numbers">
<h3>Records != Numbers<a class="headerlink" href="#records-numbers" title="Permalink to this headline">¶</a></h3>
<p><em>The form numerical data takes once dumped on disk is completely irrelevant to
the specifications of records in the repository history.</em></p>
<p>Now, let’s unpack this for a bit. We know from`Numbers == Numbers`_ that data is
saved to disk in some arbitrary locations with some arbitrary backend. We also
know from <a class="reference internal" href="#data-is-large-we-don-t-waste-space">Data Is Large, We Don’t Waste Space</a> that the permanent repository
information only contains a record which links a sample name to a uuid and a
hash. We also assert that there is also a mapping of hash to storage backend
specification kept somewhere (doesn’t matter what that mapping is for the
moment). With those 3 pieces of information, it’s obvious that once data is
placed in the repository, we don’t actually need to interact with it to
understand the accounting of what was added when!</p>
<p>In order to make a commit, we just pack up all the records which existed in the
staging area, create a hash of the records (including the hash of any parent
commits), and then store the commit hash mapping alongside details such as the
commit user/email and commit message, and a compressed version of the full
commit records as they existed at that point in time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>That last point “storing a compressed version of the full commit records”, is
semi inefficient, and will be changed in the future so that unchanged records
are note duplicated across commits.</p>
</div>
<p>An example is given below of the keys -&gt; values mapping which stores each of the
staged records, and which are packed up / compressed on commit (and subsequently
unpacked on checkout!).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Num</span> <span class="n">dsets</span>                      <span class="s1">&#39;a.&#39;</span>               <span class="o">-&gt;</span> <span class="s1">&#39;2&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">dset</span> <span class="o">-&gt;</span> <span class="n">num</span> <span class="n">samples</span> <span class="o">||</span> <span class="s1">&#39;a.train_images&#39;</span>   <span class="o">-&gt;</span> <span class="s1">&#39;10&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.0&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_1 BAR_HASH_1&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.1&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_2 BAR_HASH_2&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.2&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_3 BAR_HASH_3&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.3&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_4 BAR_HASH_4&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.4&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_5 BAR_HASH_5&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.5&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_6 BAR_HASH_6&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.6&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_7 BAR_HASH_7&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.7&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_8 BAR_HASH_8&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.8&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_9 BAR_HASH_9&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_images.9&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;foo_uuid_0 BAR_HASH_0&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">dset</span> <span class="o">-&gt;</span> <span class="n">num</span> <span class="n">samples</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels&#39;</span>   <span class="o">-&gt;</span> <span class="s1">&#39;10&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.0&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_11</span> <span class="n">BAR_HASH_11</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.1&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_12</span> <span class="n">BAR_HASH_12</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.2&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_13</span> <span class="n">BAR_HASH_13</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.3&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_14</span> <span class="n">BAR_HASH_14</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.4&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_15</span> <span class="n">BAR_HASH_15</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.5&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_16</span> <span class="n">BAR_HASH_16</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.6&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_17</span> <span class="n">BAR_HASH_17</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.7&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_18</span> <span class="n">BAR_HASH_18</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.8&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_19</span> <span class="n">BAR_HASH_19</span><span class="s1">&#39;</span>
<span class="n">Name</span> <span class="n">of</span> <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">uuid</span> <span class="o">&amp;</span> <span class="nb">hash</span> <span class="o">||</span> <span class="s1">&#39;a.train_labels.9&#39;</span> <span class="o">-&gt;</span> <span class="n">foo_uuid_10</span> <span class="n">BAR_HASH_10</span><span class="s1">&#39;</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="s1">&#39;s.train_images&#39;</span>   <span class="o">-&gt;</span> <span class="s1">&#39;{&quot;schema_uuid&quot;: &quot;f0f6c35853ce11e998d18c859047adef&quot;,</span>
                        <span class="s2">&quot;schema_hash&quot;</span><span class="p">:</span> <span class="s2">&quot;RM4DefFsjRs=&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;schema_dtype&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s2">&quot;schema_is_var&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                        <span class="s2">&quot;schema_max_shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">784</span><span class="p">],</span>
                        <span class="s2">&quot;schema_is_named&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span><span class="s1">&#39;</span>
<span class="s1">&#39;s.train_labels&#39;</span>   <span class="o">-&gt;</span>  <span class="s1">&#39;{&quot;schema_uuid&quot;: &quot;f13d92d853ce11e983898c859047adef&quot;,</span>
                        <span class="s2">&quot;schema_hash&quot;</span><span class="p">:</span>
                        <span class="s2">&quot;ncbHqE6Xldg=&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;schema_dtype&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                        <span class="s2">&quot;schema_is_var&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
                        <span class="s2">&quot;schema_max_shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;schema_is_named&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="history-is-relative">
<h3>History is Relative<a class="headerlink" href="#history-is-relative" title="Permalink to this headline">¶</a></h3>
<p>Though it may be a bit obvious to state, it is of critical importance to realize
that it is only because we store the full contents of the repository staging
area as it existed in the instant just prior to a commit, that the integrity of
full repository history can be verified from a single commit’s contents and
expected hash value. More so, any single commit has only a topical relationship
to a commit at any other point in time. It is only our imposition of a commit’s
ancestry tree which actualizes any subsequent insights or interactivity</p>
<p>While the general process of topological ordering: create branch, checkout
branch, commit a few times, and merge, follows the <cite>git</cite> model fairly well at a
conceptual level, there are some important
differences we want to highlight due to their implementation differences:</p>
<ol class="arabic simple">
<li><p>Multiple commits can simultaneously checked out in “read-only” mode on a
single machine. Checking out a commit for reading does not touch the staging
area status.</p></li>
<li><p>Only one process can interact with the a write-enabled checkout at a time.
<strong>LINK DOCS HERE</strong></p></li>
<li><p>A detached head CANNOT exist for write enabled checkouts. A staging area must
begin with an identical state to the most recent commit of a/any branch.</p></li>
<li><p>A staging area which has had changes made in it cannot switch base branch
without either a commit, hard-reset, or (soon to be developed) stash
operation.</p></li>
</ol>
<p>When a repository is initialized, a record is created which indicates the
staging area’s <cite>HEAD</cite> branch. in addition, a branch is created with the name
<cite>master</cite>, and which is the only commit in the entire repository which will have
no parent. The record key/value pairs resemble the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;branch.master&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;&#39;</span>                <span class="c1"># No parent commit.</span>
<span class="s1">&#39;head&#39;</span>          <span class="o">-&gt;</span> <span class="s1">&#39;branch.master&#39;</span>   <span class="c1"># Staging area head branch</span>

<span class="c1"># Commit Hash  |  Parent Commit</span>
<span class="o">-------------------------------------</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Much like git, odd things can happen before the <cite>‘initial commit’</cite> is made. We
recommend creating the initial commit as quickly as possible to prevent
undefined behavior during repository setup. In the future, we may decide to
create the “initial commit” automatically upon repository initialization.</p>
</div>
<p>Once the initial commit is made, a permanent commit record in made which
specifies the records (not shown below) and the parent commit. The branch head
pointer is then updated to point to that commit as it’s base.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;branch.master&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;479b4cfff6219e3d&#39;</span>
<span class="s1">&#39;head&#39;</span>          <span class="o">-&gt;</span> <span class="s1">&#39;branch.master&#39;</span>

<span class="c1"># Commit Hash       |  Parent Commit</span>
<span class="o">-------------------------------------</span>
<span class="s1">&#39;479b4cfff6219e3d&#39;</span> <span class="o">-&gt;</span>  <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>Branches can be created as cheaply a single line of text can be written, and
they simply require a “root” commit hash (or a branch name, in which case the
branch’s current HEAD commit will be used as the root HEAD). Likewise a branch
can be merged with just a single write operation (once the merge logic has
completed - a process which is explained separately from this section; just
trust that it happens for now).</p>
<p>A more complex example which creates 4 different branches and merges them in a
complicated order can be seen below. Please note that the `` &lt;&lt; `` symbol is
used to indicate a merge commit where <cite>X &lt;&lt; Y</cite> reads: <code class="docutils literal notranslate"><span class="pre">'merging</span> <span class="pre">dev</span> <span class="pre">branch</span> <span class="pre">Y</span>
<span class="pre">into</span> <span class="pre">master</span> <span class="pre">branch</span> <span class="pre">X'</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;branch.large_branch&#39;</span> <span class="o">-&gt;</span> <span class="s1">&#39;8eabd22a51c5818c&#39;</span>
<span class="s1">&#39;branch.master&#39;</span>       <span class="o">-&gt;</span> <span class="s1">&#39;2cd30b98d34f28f0&#39;</span>
<span class="s1">&#39;branch.test_branch&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;1241a36e89201f88&#39;</span>
<span class="s1">&#39;branch.trydelete&#39;</span>    <span class="o">-&gt;</span> <span class="s1">&#39;51bec9f355627596&#39;</span>
<span class="s1">&#39;head&#39;</span>                <span class="o">-&gt;</span> <span class="s1">&#39;branch.master&#39;</span>

 <span class="c1"># Commit Hash       |  Parent Commit</span>
 <span class="o">-------------------------------------</span>
<span class="s1">&#39;1241a36e89201f88&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;8a6004f205fd7169&#39;</span>
<span class="s1">&#39;2cd30b98d34f28f0&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;9ec29571d67fa95f &lt;&lt; 51bec9f355627596&#39;</span>
<span class="s1">&#39;51bec9f355627596&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;d683cbeded0c8a89&#39;</span>
<span class="s1">&#39;69a09d87ea946f43&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;d683cbeded0c8a89&#39;</span>
<span class="s1">&#39;8a6004f205fd7169&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;a320ae935fc3b91b&#39;</span>
<span class="s1">&#39;8eabd22a51c5818c&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;c1d596ed78f95f8f&#39;</span>
<span class="s1">&#39;9ec29571d67fa95f&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;69a09d87ea946f43 &lt;&lt; 8eabd22a51c5818c&#39;</span>
<span class="s1">&#39;a320ae935fc3b91b&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;e3e79dd897c3b120&#39;</span>
<span class="s1">&#39;c1d596ed78f95f8f&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;&#39;</span>
<span class="s1">&#39;d683cbeded0c8a89&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;fe0bcc6a427d5950 &lt;&lt; 1241a36e89201f88&#39;</span>
<span class="s1">&#39;e3e79dd897c3b120&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;c1d596ed78f95f8f&#39;</span>
<span class="s1">&#39;fe0bcc6a427d5950&#39;</span>  <span class="o">-&gt;</span> <span class="s1">&#39;e3e79dd897c3b120&#39;</span>
</pre></div>
</div>
<p>Because the raw commit hash logs can be quite dense to parse, a graphical
logging utility is included as part of the repository. Running the
<cite>Repository.log()</cite> method will pretty print a graph representation of the commit
history:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">hangar</span> <span class="kn">import</span> <span class="n">Repository</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span> <span class="o">=</span> <span class="n">Repository</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/foo/bar/path/&#39;</span><span class="p">)</span>

<span class="gp">... </span><span class="c1"># make some commits</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">repo</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/repo_graph_log.png" src="_images/repo_graph_log.png" />
</div>
<div class="section" id="merge-strategies">
<h3>Merge Strategies<a class="headerlink" href="#merge-strategies" title="Permalink to this headline">¶</a></h3>
<p><strong>TODO: EXPAND ON THIS SECTION</strong></p>
<p>There are a few ways which we can currently merge:</p>
<ul class="simple">
<li><p>Fast-Forward -&gt; update branch head pointers</p></li>
<li><p>3-way merge -&gt; calculate merge base and diff/patch dev/master from there.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Hangar-Tutorial-002.html" class="btn btn-neutral float-left" title="Part 2: Checkouts, Branching, &amp; Merging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020, Richard Izzo
      <span class="lastupdated">
        Last updated on May 24, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>